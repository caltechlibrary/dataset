.\" Automatically generated by Pandoc 3.1.4
.\"
.\" Define V font for inline verbatim, using C font in formats
.\" that render this, and otherwise B font.
.ie "\f[CB]x\f[]"x" \{\
. ftr V B
. ftr VI BI
. ftr VB B
. ftr VBI BI
.\}
.el \{\
. ftr V CR
. ftr VI CI
. ftr VB CB
. ftr VBI CBI
.\}
.TH "dsquery" "1" "2023-09-27" "dataset user manual" "version 2.1.3 3b8a1de"
.hy
.SH NAME
.PP
dsquery
.SH SYNOPSIS
.PP
dsquery OPTIONS C_NAME SQL_STATEMENT [PARAMS]
.SH DESCRIPTION
.PP
\f[B]dsquery\f[R] is a tool to support SQL queries of dataset
collections that use SQL storage for the collection\[cq]s JSON
documents.
It takes a dataset collection name and a sql statement returning the
results.
This will allow us to improve our feeds building process by taking
advantage of SQL and the collection\[cq]s SQL database engine.
.PP
The scheme for the JSON stored documents have a four column scheme.
The columns are \[lq]_key\[rq], \[lq]created\[rq], \[lq]updated\[rq] and
\[lq]src\[rq].
The are stored in a table with the same name as the database which is
formed from the C_NAME without extension (e.g.\ data.ds is stored in a
database called data having a table also called data).
.SH PARAMETERS
.TP
C_NAME
If harvesting the dataset collection name to harvest the records to.
.TP
SQL_STATEMENT
The SQL statement should conform to the SQL dialect used for the JSON
store for the JSON store (e.g.\ Postgres, MySQL and SQLite 3).
The SELECT clause should return a single JSON object type per row.
\f[B]dsquery\f[R] returns an JSON array of JSON objects returned by the
SQL query.
.TP
PARAMS
Is optional, it is any values you want to pass to the SQL_STATEMENT.
.SH SQL Store Scheme
.TP
_key
The key or id used to identify the JSON documented stored.
.TP
src
This is a JSON column holding the JSON document
.TP
created
The date the JSON document was created in the table
.TP
updated
The date the JSON document was updated
.SH OPTIONS
.TP
help
display help
.TP
license
display license
.TP
version
display version
.SH EXAMPLES
.PP
Generate a list of JSON objects with the \f[V]_key\f[R] value merged
with the object stored as the \f[V]._Key\f[R] attribute.
The colllection name \[lq]data.ds\[rq] which is implemented using
Postgres as the JSON store.
(note: in Postgres the \f[V]||\f[R] is very helpful).
.IP
.nf
\f[C]
dsquery data.ds \[dq]SELECT jsonb_build_object(\[aq]_Key\[aq], _key)::jsonb || src::jsonb FROM data\[dq]
\f[R]
.fi
.PP
In this example we\[cq]re returning the \[lq]src\[rq] in our collection
by querying for a \[lq]id\[rq] attribute in the \[lq]src\[rq] column.
The id is passed in as an attribute using the Postgres positional
notatation in the statement.
.IP
.nf
\f[C]
dsquery data.ds \[dq]SELECT src FROM data WHERE src->>\[aq]id\[aq] = $1 LIMIT 1\[dq] \[dq]xx103-3stt9\[dq]
\f[R]
.fi
.SH AUTHORS
R. S. Doiel and Tom Morrell.
